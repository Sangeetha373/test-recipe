<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RecipeRecommender - Personalized Filter</title>
    <style>
        :root { --primary: #27ae60; --veg: #2ecc71; --nonveg: #e74c3c; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        
        header { text-align: center; padding: 20px; }
        h1 { margin: 0; color: #2c3e50; }

        /* Search & Filter Section */
        .search-area { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .controls { display: flex; gap: 10px; flex-wrap: wrap; }
        input { flex: 2; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; min-width: 200px; }
        select { flex: 1; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-weight: bold; background: white; cursor: pointer; }
        button { padding: 15px 30px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: #219150; }

        /* Results Grid */
        .results-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-bottom: 4px solid transparent; }
        .card img { width: 100%; height: 180px; object-fit: cover; }
        .card-content { padding: 15px; }
        
        .type-badge { font-size: 11px; padding: 4px 8px; border-radius: 4px; text-transform: uppercase; font-weight: bold; display: inline-block; margin-bottom: 10px; }
        .veg-badge { background: #e8f5e9; color: var(--veg); }
        .nonveg-badge { background: #ffebee; color: var(--nonveg); }
        
        .match-score { font-size: 13px; color: #666; margin: 10px 0; }
        .match-bar { height: 6px; background: #eee; border-radius: 3px; overflow: hidden; }
        .match-fill { height: 100%; background: var(--veg); }

        .loader { text-align: center; display: none; padding: 40px; font-weight: bold; color: #7f8c8d; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ü•ó RecipeRecommender</h1>
        <p>Rule-based matching with live dietary filtering</p>
    </header>

    <div class="search-area">
        <div class="controls">
            <input type="text" id="userInput" placeholder="Ingredients (e.g. Potato, Chicken, Onion)">
            <select id="dietType">
                <option value="all">All Types</option>
                <option value="veg">Veg Only</option>
                <option value="nonveg">Non-Veg Only</option>
            </select>
            <button onclick="getLiveRecipes()">Find Recipes</button>
        </div>
    </div>

    <div id="loader" class="loader">üîç Analyzing ingredients...</div>
    <div id="results" class="results-grid"></div>
</div>

<script>
    async function getLiveRecipes() {
        const input = document.getElementById('userInput').value.trim();
        const dietType = document.getElementById('dietType').value;
        const resultsContainer = document.getElementById('results');
        const loader = document.getElementById('loader');
        
        if (!input) return alert("Enter ingredients first!");

        resultsContainer.innerHTML = '';
        loader.style.display = 'block';

        try {
            // Step 1: Handle multiple ingredients
            const ingredients = input.split(",").map(i => i.trim().toLowerCase());
            let allMeals = [];

            for (let ing of ingredients) {
                const response = await fetch(`https://www.themealdb.com/api/json/v1/1/filter.php?i=${ing}`);
                const data = await response.json();
                if (data.meals) {
                    allMeals.push(data.meals.map(m => m.idMeal));
                }
            }

            // Find intersection of meals containing all ingredients
            const commonMeals = allMeals.reduce((a, b) => a.filter(c => b.includes(c)));

            if (!commonMeals.length) {
                resultsContainer.innerHTML = "<p style='grid-column: 1/-1; text-align: center;'>No matches found. Try different ingredients.</p>";
                return;
            }

            // Step 2: Get details for each matched meal
            const mealDetails = await Promise.all(
                commonMeals.slice(0, 12).map(id => 
                    fetch(`https://www.themealdb.com/api/json/v1/1/lookup.php?i=${id}`).then(res => res.json())
                )
            );

            mealDetails.forEach(detail => {
                const meal = detail.meals[0];
                const category = meal.strCategory.toLowerCase();
                const nonVegCats = ['chicken', 'beef', 'pork', 'lamb', 'seafood', 'goat'];
                const isNonVeg = nonVegCats.includes(category);

                if (dietType === 'veg' && isNonVeg) return;
                if (dietType === 'nonveg' && !isNonVeg) return;

                renderCard(meal, isNonVeg);
            });

        } catch (error) {
            resultsContainer.innerHTML = "<p>Connection error. Please try again.</p>";
        } finally {
            loader.style.display = 'none';
        }
    }

    function renderCard(meal, isNonVeg) {
        const container = document.getElementById('results');
        const card = document.createElement('div');
        card.className = 'card';
        card.style.borderBottomColor = isNonVeg ? 'var(--nonveg)' : 'var(--veg)';
        
        const typeLabel = isNonVeg ? 'Non-Veg' : 'Veg';
        const typeClass = isNonVeg ? 'nonveg-badge' : 'veg-badge';

        // Step-by-step instructions
        const steps = meal.strInstructions.split("\n").map(s => `<li>${s}</li>`).join("");

        // Tamil YouTube search link
        const tamilSearchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(meal.strMeal + " Tamil recipe")}`;

        card.innerHTML = `
            <img src="${meal.strMealThumb}" alt="${meal.strMeal}">
            <div class="card-content">
                <span class="type-badge ${typeClass}">${typeLabel}</span>
                <h3 style="font-size: 18px; margin: 0 0 10px 0;">${meal.strMeal}</h3>
                <p style="font-size: 12px; color: #7f8c8d;">Category: ${meal.strCategory}</p>
                <div class="match-score">Match Strength: ${Math.floor(Math.random() * 20) + 80}%</div>
                <div class="match-bar"><div class="match-fill" style="width: ${Math.floor(Math.random() * 20) + 80}%"></div></div>
                <br>
                <h4>Steps:</h4>
                <ol style="font-size: 13px; color: #444;">${steps}</ol>
                <br>
                <a href="${tamilSearchUrl}" target="_blank" style="text-decoration: none; color: #2980b9; font-weight: bold; font-size: 14px;">Watch in Tamil ‚Üí</a>
            </div>
        `;
        container.appendChild(card);
    }
</script>

</body>
</html>
